<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>파스텔톤 주간 플래너</title>

<style>
body{
  margin:0;
  font-family:Malgun Gothic, Arial;
  background:#f6f6ff;
}

header{
  position:sticky;
  top:0;
  background:#ffffffcc;
  backdrop-filter:blur(8px);
  border-bottom:1px solid #ddd;
  padding:10px;
  z-index:100;
}

button{
  padding:6px 10px;
  border-radius:6px;
  border:1px solid #ccc;
  background:#fff;
}

table{
  width:100%;
  border-collapse:collapse;
}

th, td{
  border:1px solid #ddd;
  height:40px;
  padding:4px;
  vertical-align:top;
  font-size:13px;
}

th{
  background:#e9e8ff;
}

td{
  background:#fafaff;
  cursor:pointer;
}

.modal-backdrop{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.25);
  display:none;
  justify-content:center;
  align-items:center;
  z-index:1000;
}

.modal{
  background:#fff;
  border-radius:10px;
  width:90%;
  max-width:400px;
  padding:12px;
}

.modal textarea{
  width:100%;
  height:120px;
}
</style>
</head>

<body>

<header>
<b>파스텔톤 주간 플래너</b>
<button onclick="manualSave()">수동 저장</button>
<button onclick="openBackup()">백업 리스트</button>
</header>

<table id="planner">
<thead>
<tr>
<th>시간</th>
<th>월</th><th>화</th><th>수</th><th>목</th><th>금</th><th>토</th><th>일</th>
</tr>
</thead>
<tbody id="body"></tbody>
</table>

<!-- Cell Modal -->
<div class="modal-backdrop" id="cellBackdrop">
<div class="modal">
<b id="cellLabel">내용 입력</b>
<textarea id="cellInput"></textarea>
<br><br>
<button id="cancelCellBtn">취소</button>
<button id="clearCellBtn">비우기</button>
<button id="saveCellBtn">저장</button>
</div>
</div>

<!-- Backup Modal -->
<div class="modal-backdrop" id="backupBackdrop">
<div class="modal">
<b>백업 리스트</b>
<div id="backupList"></div>
<br>
<button onclick="closeBackup()">닫기</button>
</div>
</div>

<script>
const body = document.getElementById("body");
let editing = null;

// 시간 생성
for(let h=6; h<=22; h++){
  const tr=document.createElement("tr");
  const th=document.createElement("th");
  th.textContent=(h<10?"0":"")+h+":00";
  tr.appendChild(th);

  for(let d=0; d<7; d++){
    const td=document.createElement("td");
    td.dataset.key=h+"-"+d;
    td.onclick=()=>openCell(td);
    tr.appendChild(td);
  }
  body.appendChild(tr);
}

// 로컬 저장 구조
const DATA_KEY="planner_data";
const BACKUP_KEY="planner_backup";

function load(){
  const data=JSON.parse(localStorage.getItem(DATA_KEY)||"{}");
  document.querySelectorAll("td").forEach(td=>{
    td.textContent=data[td.dataset.key]||"";
  });
}

function save(){
  const data={};
  document.querySelectorAll("td").forEach(td=>{
    if(td.textContent) data[td.dataset.key]=td.textContent;
  });
  localStorage.setItem(DATA_KEY, JSON.stringify(data));
}

// 셀 입력
function openCell(td){
  editing=td;
  document.getElementById("cellInput").value=td.textContent;
  document.getElementById("cellBackdrop").style.display="flex";
}

document.getElementById("cancelCellBtn").onclick=()=>{
  document.getElementById("cellBackdrop").style.display="none";
};

document.getElementById("clearCellBtn").onclick=()=>{
  if(editing){
    editing.textContent="";
    save();
  }
  document.getElementById("cellBackdrop").style.display="none";
};

document.getElementById("saveCellBtn").onclick=()=>{
  if(editing){
    editing.textContent=document.getElementById("cellInput").value;
    save();
  }
  document.getElementById("cellBackdrop").style.display="none";
};

// Ctrl+Enter 저장 / Ctrl+Del 비우기
document.getElementById("cellInput").addEventListener("keydown",e=>{
  if(e.ctrlKey && e.key==="Enter"){
    e.preventDefault();
    saveCellBtn.click();
  }
  if(e.ctrlKey && (e.key==="Delete" || e.key==="Backspace")){
    e.preventDefault();
    clearCellBtn.click();
  }
});

// 자동백업 (1분)
setInterval(()=>{
  const backups=JSON.parse(localStorage.getItem(BACKUP_KEY)||"[]");
  backups.push({
    type:"자동",
    time:new Date().toLocaleString(),
    data:localStorage.getItem(DATA_KEY)
  });

  while(backups.length>5) backups.shift();
  localStorage.setItem(BACKUP_KEY, JSON.stringify(backups));
},60000);

// 수동저장
function manualSave(){
  const backups=JSON.parse(localStorage.getItem(BACKUP_KEY)||"[]");
  backups.push({
    type:"수동",
    time:new Date().toLocaleString(),
    data:localStorage.getItem(DATA_KEY)
  });
  localStorage.setItem(BACKUP_KEY, JSON.stringify(backups));
  alert("수동 저장 완료");
}

// 백업 리스트
function openBackup(){
  const list=document.getElementById("backupList");
  list.innerHTML="";
  const backups=JSON.parse(localStorage.getItem(BACKUP_KEY)||"[]");

  backups.forEach((b,i)=>{
    const div=document.createElement("div");
    div.innerHTML=`(${b.type}) ${b.time} 
    <button onclick="restore(${i})">복원</button>`;
    list.appendChild(div);
  });

  document.getElementById("backupBackdrop").style.display="flex";
}

function closeBackup(){
  document.getElementById("backupBackdrop").style.display="none";
}

function restore(i){
  const backups=JSON.parse(localStorage.getItem(BACKUP_KEY)||"[]");
  if(confirm("복원하시겠습니까?")){
    localStorage.setItem(DATA_KEY, backups[i].data);
    load();
    closeBackup();
  }
}

// 인쇄시 버튼 숨김
const style=document.createElement("style");
style.innerHTML="@media print{button{display:none}}";
document.head.appendChild(style);

// 시작
load();
</script>

</body>
</html>
